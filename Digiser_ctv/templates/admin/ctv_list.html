{% extends 'bases/base.html' %} {% block content %}
{% load extras %}

<style>
  table {
    width: 100%;
    border-collapse: collapse;
  }

  table th{
    padding: 5px 5px 5px 12px;
    position: -webkit-sticky;
    position: sticky;
    top: -1px;  
    color: white;
    text-align: center;
    font-size: 20px;
  }

  .iconThTable{
    font-size: 25px;
    position: relative;
    top: 2px;
  }

  th,td {
    border: 1px solid black;
    padding: 8px;
  }

  th {
    background-color: #4689b8;
  }

  thead th {
    width: 15%;
  }

  .selected {
    background-color: #d1dfe7;
  }
</style>

<!-- css ban con -->
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
  }

  body {
    background-color: #f4f4f4;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .container {
    max-width: 500px;
    background-color: white;
    padding: 20px;
    border: 1px dashed #ccc;
    border-radius: 10px;
    width: 650px;
    background: #dfdedecc;
  }

  .user-form {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .form-group {
    margin-bottom: 15px;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }

  label {
    display: block;
    font-size: 14px;
    margin-bottom: 5px;
    font-weight: bold;
  }

  input[type="text"],
  select {
    width: 100%;
    padding: 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }

  input[readonly] {
    background-color: #f1f1f1;
  }

  .form-actions {
    display: flex;
    justify-content: space-between;
  }

  .reset-btn,
  .save-btn {
    padding: 10px 20px;
    font-size: 14px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  .reset-btn {
    background-color: #f4f4f4;
  }

  .save-btn {
    background-color: #007bff;
    color: white;
  }

  .save-btn:hover {
    background-color: #0056b3;
  }

  .reset-btn:hover {
    background-color: #e0e0e0;
  }

  .form-label-inline {
    flex: 1;
  }

  .form-input-inline,
  .form-select-inline {
    flex: 2;
    width: 100%;
    padding: 5px;
    border-radius: 5px;
    border: 1px solid #ccc;
  }

  .btn-search .quick-filter-button{
    background-color: #D9D9D9;
    color: black;
    font-size: 20px;
    border-radius: 15px;
    box-shadow: none;
  }

  .btn-search .quick-filter-button:hover{
    box-shadow: none;
  }

  .btn-search .quick-filter-button i{
    font-size: 25px;
  }

  .title-name{
    color: #0071BC;
    font-size: 30px;
    font-weight: bold;
  }
</style>

<!-- Thêm CSS để định dạng các nút tìm kiếm nhanh -->
<style>
  .search-container {
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: flex-start;
  }

  .quick-search {
    display: flex;
    gap: 10px;
  }

  .quick-search input,
  .quick-search select {
    padding: 8px;
    background-color: #D9D9D9;
    color: black;
    font-size: 20px;
    border-radius: 15px;
    width: 200px;
  }

  ::placeholder {
    color: rgb(0, 0, 0);
    opacity: 1; /* Firefox */
  }

  ::-ms-input-placeholder { /* Edge 12-18 */
    color: rgb(0, 0, 0);
  }

  .quick-search select {
    width: 200px;
    height: 45px;
    appearance: none;
  }

  .filter-buttonIcon{
    font-size: 40px;
    position: relative;
    left: -50px;
    bottom: -2px;  
    z-index: 4;  
  }

  .btn-filter{
    display: flex;
    gap: 10px;
  }

  .quick-search .btn-inPut{
    width: 125px;
    height: 45px;
    background-color: #038CFD;
    border-radius: 15px;
  }

.iconBtn-inPut{
    font-size: 25px;
  }

  .quick-search .btn-outPut{
    width: 125px;
    height: 45px;
    background-color: #038CFD;
    border-radius: 15px;
  }

.iconBtn-outPut{
    font-size: 25px;
  }
</style>

<h1 class="title-name">QUẢN LÝ CTV</h1>
<!-- Thanh tìm kiếm nhanh và nút lọc -->
<div class="search-container">
  <!-- Nút lọc -->
  <div class="btn-search">
    <button
    type=""
    class="quick-filter-button"
    data-bs-toggle="modal"
    data-bs-target="#filterModal"
    >
      <i class='bx bx-slider' style='color:#0071bc'  ></i>Lọc 
    </button>
  </div>
  <!-- Tìm kiếm nhanh với các ô nhập liệu -->
  <div class="quick-search">
    <input type="text" id="quickSearchName"placeholder="Họ tên" />
    <div class="btn-filter">
      <select id="quickSearchStatus">
        <option value="">Trạng thái 
        </option>
        {% for status_value, status_label in status_choices %}
        <option value="{{ status_value }}">{{ status_label }}</option>
        {% endfor %}
        <i class='bx bxs-chevron-down filter-buttonIcon' style='color:#0071bc'  ></i>
      </select>
      <select id="quickSearchStatus">
    </div>
    <div class="btn-filter">
      <option>
        Điểm đánh giá
      </option>
      <option>
        Cao nhất
      </option>
      <option>
        Thấp nhất
      </option>
      <i class='bx bxs-chevron-down filter-buttonIcon' style='color:#0071bc'  ></i>
    </select>
    </div>
    <button class="btn-inPut"><i class='bx bx-arrow-to-bottom iconBtn-inPut' style='color:#ffffff'></i> Nhập</button>
    <button class="btn-outPut"><i class='bx bx-arrow-from-bottom iconBtn-inPut' style='color:#ffffff'></i> Xuất</button>
  </div>
</div>

<!-- Modal Lọc -->
<div
  class="modal fade"
  id="filterModal"
  tabindex="-1"
  aria-labelledby="filterModalLabel"
  aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="filterModalLabel">Lọc Nhân Viên</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form id="searchForm" method="get" action="">
          <div class="mb-3">
            <label for="filterId" class="form-label">Tìm kiếm ID</label>
            <input
              type="text"
              class="form-control"
              id="filterId"
              name="filter_id"
              placeholder="Nhập ID"
            />
          </div>
          <div class="mb-3">
            <label for="filterName" class="form-label">Tìm kiếm Họ tên</label>
            <input
              type="text"
              class="form-control"
              id="filterName"
              name="filter_name"
              placeholder="Nhập Họ và tên"
            />
          </div>
          
          <div class="mb-3">
            <label class="form-label">Vai trò</label>
            <div class="list-group">
              <div class="list-button-for-search">
                <div class="row">
                  {% for group in groups %}
                  <div class="col-md-4 mb-2"> 
                    <input type="checkbox" class="btn-check" id="group-{{ group.id }}" name="group" value="{{ group.name }}" autocomplete="off">
                    <label class="btn btn-outline-primary list-group-item" for="group-{{ group.id }}">{{ group.name }}</label>
                  </div>
                  {% empty %}
                    <p>Không lấy được dữ liệu.</p>
                  {% endfor %}
                </div>
              </div>    
            </div>
          </div>

          <div class="mb-3">
            <label for="filterStatus" class="form-label"
              >Tìm kiếm Trạng thái</label
            >
            <select class="form-select" id="filterStatus" name="filter_status">
              <option value="">Chọn trạng thái</option>
              {% for status_value, status_label in status_choices %}
              <option value="{{ status_value }}">{{ status_label }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="filterSubmit">
              Lọc
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Đóng
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div style="overflow: auto; height: 650px" class="col-xs-7 col-sm-6 col-lg-8">
    <table>
      <thead>
        <tr>
          <th>ID <i class='bx bxs-chevron-down iconThTable' style='color:#ffffff' ></i></th>
          <th>Họ & Tên <i class='bx bxs-chevron-down iconThTable' style='color:#ffffff' ></i></th>
          <th>Vai Trò <i class='bx bxs-chevron-down iconThTable' style='color:#ffffff' ></i></th>
          <th>Trạng Thái <i class='bx bxs-chevron-down iconThTable' style='color:#ffffff' ></i></th>
          <th>ĐIểm Đánh giá <i class='bx bxs-chevron-down iconThTable' style='color:#ffffff' ></i></th>
          {% comment %} <th>Actions</th> {% endcomment %}
        </tr>
      </thead>
      <tbody>
        {% for user in users_page %}
        <tr>
          <td>{{ user.code }}</td>
          <td>{{ user.full_name }}</td>
          <td> 
            {% if user.groups.all %}
              {% for group in user.groups.all %}
                  {{ group.name }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
            {% else %}
                Không thuộc nhóm nào
            {% endif %}
        </td>
          <td>{{ user.status }}</td>
          <td>100</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="col-xs-5 col-sm-6 col-lg-4">
    <div class="container">
      <form class="user-form">
        <div class="form-group">
          <label for="id" class="form-label-inline form-label">ID:</label>
          <input
            type="text"
            id="id"
            name="id"
            class="form-label-inline"
            value=""
          />
        </div>

        <div class="form-group">
          <label for="name" class="form-label-inline form-label"
            >Họ và tên:</label
          >
          <input
            type="text"
            id="name"
            name="name"
            class="form-label-inline"
            value=" "
          />
        </div>

        <div class="mb-3">
          <label class="form-label-inline">Vai trò</label>
          <div class="list-group">
            <div class="list-button-in-small-table">
              <div class="row">
                {% for group in groups %}
                <div class="col-md-4 mb-2"> 
                  <input type="checkbox" class="btn-check" id="group-in-table-{{ group.id }}" name="group" value="{{ group.name }}" autocomplete="off">
                  <label class="btn btn-outline-primary list-group-item" for="group-in-table-{{ group.id }}">{{ group.name }}</label>
                </div>
                {% empty %}
                  <p>Không lấy được dữ liệu.</p>
                {% endfor %}         
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="status" class="form-label-inline form-label">Trạng thái:</label>
          <select
            class="form-select form-label-inline"
            id="status"
            name="status"
          >
            {% for status_value, status_label in status_choices %}
            <option value="{{ status_value }}">{{ status_label }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-actions">
          <button type="button" class="reset-btn">Đặt lại</button>
          <button type="submit" class="save-btn">Lưu</button>
        </div>
      </form>
    </div>
  </div>
</div>



<div class="pagination">
  <span class="step-links">
    {% if page_obj.has_previous %}
      <a href="?page=1">&laquo; First</a>
      <a href="?page={{ page_obj.previous_page_number }}">Previous</a>
    {% endif %}

    {% with total_pages=page_obj.paginator.num_pages current_page=page_obj.number %}
      {% if total_pages > 5 %}
        <!-- Calculate the start and end of the pagination range -->
        {% if current_page <= 3 %}
          {% set start_page = 1 %}
          {% set end_page = 5 %}
        {% elif current_page > total_pages|add:'-3' %}
          {% set start_page = total_pages|add:'-4' %}
          {% set end_page = total_pages %}
        {% else %}
          {% set start_page = current_page|add:'-2' %}
          {% set end_page = current_page|add:'2' %}
        {% endif %}

        <!-- Render page numbers within the calculated range -->
        {% for page_num in start_page|default:1|add:0|get_range:end_page %}
          {% if page_num == page_obj.number %}
            <span class="current" style="padding: 5px; font-weight: bold; border: 1px solid #4689b8; background-color: #4689b8; color: white;">{{ page_num }}</span>
          {% else %}
            <a href="?page={{ page_num }}" style="padding: 5px; border: 1px solid #ccc;">{{ page_num }}</a>
          {% endif %}
        {% endfor %}
      {% else %}
        <!-- If less than 5 pages, display all pages -->
        {% for page_num in page_obj.paginator.page_range %}
          {% if page_num == page_obj.number %}
            <span class="current" style="padding: 5px; font-weight: bold; border: 1px solid #4689b8; background-color: #4689b8; color: white;">{{ page_num }}</span>
          {% else %}
            <a href="?page={{ page_num }}" style="padding: 5px; border: 1px solid #ccc;">{{ page_num }}</a>
          {% endif %}
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}">Next</a>
      <a href="?page={{ page_obj.paginator.num_pages }}">Last &raquo;</a>
    {% endif %}
  </span>
</div>

{% endblock %}