{% extends 'bases/base.html' %}   
{% block content %}
<p> day la trang list ctv</p>

<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
    }
    th {
        background-color: #f2f2f2;
    }
</style>
<h1>Danh sach nhan vien</h1>
<!-- Nút lọc -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#filterModal">
    <i class='bx bx-filter-alt'></i> Lọc
</button>

<!-- Modal Lọc -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterModalLabel">Lọc Nhân Viên</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="searchForm" method="get" action="">
                    <div class="mb-3">
                        <label for="filterId" class="form-label">Tìm kiếm ID</label>
                        <input type="text" class="form-control" id="filterId" name="filter_id" placeholder="Nhập ID">
                    </div>
                    <div class="mb-3">
                        <label for="filterName" class="form-label">Tìm kiếm Họ tên</label>
                        <input type="text" class="form-control" id="filterName" name="filter_name" placeholder="Nhập Họ và tên">
                    </div>
                    <div class="mb-3">
                        <label for="filterStatus" class="form-label">Tìm kiếm Trạng thái</label>
                        <select class="form-select" id="filterStatus" name="filter_status">
                            <option value="">Chọn trạng thái</option>
                            {% for status_value, status_label in status_choices %}
                                <option value="{{ status_value }}">{{ status_label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="filterSubmit">Lọc</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    </div>
                </form>
            </div>
            
        </div>
    </div>
</div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Ho va ten</th>
                <th>Chuc vu</th>
                <th>Trang thai</th>

            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.code }}</td>
                <td>{{ user.full_name }}</td>
                <td>{{ user.role }}</td>
                <td>{{ user.status }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // Function to filter users
        function filterUsers() {
            // Lấy giá trị từ các input fields trong popup
            const filterId = document.getElementById('filterId').value.toLowerCase();
            const filterName = document.getElementById('filterName').value.toLowerCase();
            const filterStatus = document.getElementById('filterStatus').value.toLowerCase();
        
            // Lấy tất cả các hàng (rows) của bảng users
            const rows = document.querySelectorAll('table tbody tr');
        
            // Lặp qua từng hàng và kiểm tra các điều kiện
            rows.forEach(row => {
                const userId = row.querySelector('td:nth-child(1)').textContent.toLowerCase();
                const userName = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                const userStatus = row.querySelector('td:nth-child(4)').textContent.toLowerCase();
        
                // Điều kiện tìm kiếm
                const matchId = !filterId || userId.includes(filterId);
                const matchName = !filterName || userName.includes(filterName);
                const matchStatus = !filterStatus || userStatus.includes(filterStatus);
        
                // Nếu hàng phù hợp với tất cả các điều kiện, hiển thị nó, ngược lại ẩn nó
                if (matchId && matchName && matchStatus) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Khi người dùng nhấn nút "Lọc", thực hiện tìm kiếm
        document.getElementById('filterSubmit').addEventListener('click', function() {
            filterUsers();
            // Sau khi tìm kiếm, đóng popup
            const modal = document.querySelector('#filterModal');
            const modalInstance = bootstrap.Modal.getInstance(modal); // Lấy modal instance
            modalInstance.hide(); // Đóng modal
        });
        </script>
        

{% endblock %}